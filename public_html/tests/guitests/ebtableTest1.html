<!DOCTYPE html>
<html>
   <head>
      <title>Beispiel 1</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="/lib/jQueryUI-1.11.4/jquery-ui.css">
      <style>
         * {
            font-family:Arial;
            color: black;
            font-size: 10px;
         }
      </style>
      <link rel="stylesheet" href="/css/ebtable.css">

      <script src="/lib/underscore-1.8.3/underscore-1.8.3.js"></script>
      <script src="/lib/jquery-1.11.3/jquery-1.11.3.js"></script>
      <script src="/lib/jQueryUI-1.11.4/jquery-ui.js"></script>
      <script src="/js/mx.js"></script>
      <script src="/js/ebtable.js"></script>
      <script>
         'use strict';
         var basketTestdata = [
            ['GA', 'Säugetier', '', '', '', 0],
            ['GB', 'Säugetier', 'Esel', '05.08.2011', 'Liebig, Ellen, 17.08.1956', 1],
            ['GB', 'Säugetier', 'Affe', '10.06.2013', 'Heine, Heinrich, 07.12.2006', 2],
            ['GB', 'Säugetier', 'Maus', '15.09.2014', 'Manne, Antonia, 17.06.1954', 4],
            ['GB', 'Säugetier', 'Hase', '15.09.2014', 'Liebig, Ellen, 17.08.1956', 8],
            ['GB', 'Säugetier', 'Hund', '31.08.2015', 'Mann, Heinrich, 17.08.1878', 16],
            ['GA', 'Insekt', '', '', '', 0],
            ['GB', 'Insekt', 'Fliege', '31.08.2009', 'Mann, Thomas', 0],
            ['GB', 'Insekt', 'Biene', '31.08.2001', 'Lessing, Gottfried', 7],
            ['GB', 'Insekt', 'Hummel', '01.08.1759', 'Schiller, Friedrich', 0],
            ['GB', 'Insekt', 'Wespe', '31.06.1900', 'Storm, Theodor', 0],
            ['', '', 'Wolperdinger', '31.08.1915', '', 5],
            ['', '', 'Yeti', '31.08.2016', '', 31],
            ['', '', 'Einhorn', '04.11.2017', '', 63],
            ['', '', 'Lindwurm', '31.12.2018', '', 255]
         ];
//#######################################################################

         var mysortformats = {
            'flags': function (data) { // 5 (101)  -->  '!P' | 7 (111) -> '!*P'
               var flgs = '!*pfgksc';
               var s = '';
               for (var i = 0, j = 1; i < flgs.length; i++, j *= 2) {
                  s += (data & j) ? flgs[i] : '';
               }
               return s;
            }
         };

         $.extend($.fn.ebtable.sortformats, mysortformats);

         var renderer = {
            renderAuftrag: function (data, row, type) {
               if (type === 'filter') {
                  return row[1] + data;
               }
               var isOpen = grid ? grid.groupIsOpen(row[1]) : false;
               var imgsrc = '/images/group_' + (!isOpen ? 'opened' : 'closed') + '.png';
               var link = '<img src="' + imgsrc + '" onclick="grid.toggleGroupIsOpen(\'' + row[1] + '\')" /><b>&nbsp;' + row[1] + '</b>';
               return data || !row[1] ? data : link;
            },
            renderFlags: function (data, row, type) {
               if (type === 'filter') {// || type === 'display') 
                  return grid.sortformats.flags(data);
               }
               var imgmap = [
                  {key: '!', id: 1, img: 'important.gif', alt: 'Eilauftrag'},
                  {key: '*', id: 2, img: 'blackstar.gif', alt: 'Spezialfall'},
                  {key: 'P', id: 4, img: 'problem.gif', alt: 'Problemfall'},
                  {key: 'F', id: 8, img: 'caseConsolidation.gif', alt: 'Fallzusammenführung'},
                  {key: 'G', id: 16, img: 'isPrg.gif', alt: 'Prg'},
                  {key: 'K', id: 32, img: 'korrekturauftrag.gif', alt: 'Korrekturauftrag'},
                  {key: 'S', id: 64, img: 'sperre.gif', alt: 'Sperre'},
                  {key: 'C', id: 128, img: 'storniert.gif', alt: 'Stornierung angefordert'}
               ];
               var s = '';
               for (var i = 0; i < imgmap.length; i++) {
                  var o = imgmap[i];
                  if (data & o.id)
                     s += "<img src='/images/" + o.img + "' alt='" + o.alt + "' title='" + o.alt + "' />";
               }
               return s;
            }
         };
         var opts = {
            columns: [
               {name: "Grouping", order: 'asc-fix', invisible: true, technical: true},
               {name: "Gattung", invisible: true, technical: true},
               {name: "Tierart"},
               {name: "Datum", sortformat: 'date-de'},
               {name: "Welcher Name", render: renderer.renderAuftrag},
               {name: "Flag", render: renderer.renderFlags, sortformat: 'flags',tooltip: 'Mögliche Werte:!*pfgksc'}
            ],
            selection: true,
            colorder: [0, 1, 2, 3, 4, 5],
            rowsPerPageSelectValues: [2, 4, 5, 10, 15],
            rowsPerPage: 15,
            sortmaster: [{col: 1}, {col: 0}], //[{col:1,order:'asc',sortType:'date-de'},{col:2,order:'desc'}]
            groupingCols: {groupid: 1, groupsort: 0, grouphead: 'GA'}
         };
         var grid;
         $().ready(function () {
            grid = $('#grid').ebtable(opts, basketTestdata);
         });
      </script>
   </head>
   <body>
      <div id="grid"></div>
   </body>
</html>
