<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>MimaSFB</title>
  <link rel="stylesheet" href="/lib/jQueryUI-1.12.1.custom//jquery-ui.css">
  <link rel="stylesheet" href="/css/ebselect.css">
  <link rel="stylesheet" href="/css/ebtable.css">

  <style>
    * { font-family:Arial; color: black; font-size: 12px;  }
    h1 { font-size: 16px;  }
    body { background-color: #f1f1f1; }
    #layouttable1 table, #layouttable2 table { padding: 5px; margin: 10px; }
    #layouttable1 table td, #layouttable2 table td{ padding: 5px; }
    #layouttable1 input{ width:40px; }

    img.ui-datepicker-trigger{ vertical-align: bottom   } 

    xable1 td:nth-child(2) input { width:50px}
    xtable td:nth-child(2) input.hasDatepicker { width:70px}
  </style>
  <script src="/lib/underscore-1.8.3/underscore.js"></script>
  <script src="/lib/jQuery-1.11.3/jquery.js"></script>
  <script src="/lib/jQueryUI-1.12.1.custom//jquery-ui.js"></script>
  <script src="/lib/jQueryUI-1.12.0/jquery-ui-datepicker-de.js"></script>
  <script src="/lib/vue-1.0.26/vue.js"></script>
  <script src="/lib/vue-1.0.26/vue-eb.js"></script>
  <script src="/lib/numeric.js"></script>
  <script src="/lib/moment.min.js"></script>
  <script src="/js/eblib/ebdropdown.js"></script>  
  <script src="/js/eblib/mx.js"></script>  
  <script src="/js/eblib/ebtable.js"></script>  
  <script src="/js/eblib/ebbind.js"></script>  
  <script src="/js/eblib/ebutils.js"></script>  
  <script src="/js/dlgs/dlgSelectExperts.js"></script>  
  <script src="/tests/guitests/dlgtests/mima/dlgMimaSFB.js"></script>
  <script src="/data/tableData.js"></script>
  <script>
    function cp2textfield(evt) {
      var s = evt.target.id;
      var id = s.substring(2).substring(0, s.length - 3);
      var val = $(evt.target).selectmenu().val();
      $('#t' + id).val(val);
      console.log('AAA#', evt.target.id, id, val, evt);
    }
    function cp2dd(evt) {
      var id = evt.target.id.substring(1);
      var val = $(evt.target).val();
      var table = window[id + 's'];
      if (!_.findWhere(table, {number: val})) {
        $(evt.target).val('');
        $.alert('Hinweis', 'Kein erlaubter Wert: ' + val);
        return;
      }
      $('#dd' + id + 'X').val(val).selectmenu('refresh');
      console.log('BBB', evt.target.id, id, val, table, evt);
    }
    var data = {
      begutachtungsdatum: moment().format('DD.MM.YYYY')
    };

    $(document).ready(function () {
      dlgMimaSFB();
      $(".positive-integer").numeric({decimal: false, negative: false});

      $('#ddproduct').ebdropdown({change: cp2textfield}, products).ebbind(data, 'product');

      $('#ddfag').ebdropdown({change: cp2textfield}, fags.map(o => ({v: o.number, txt: o.number + ' ' + o.text}))).ebbind(data, 'fag');
      $('#ddresultcategory').ebdropdown({change: cp2textfield}, resultcategorys.map(o => ({v: o.number, txt: o.number + ' ' + o.text}))).ebbind(data, 'resultcategory');
      $('#ddresultlocation').ebdropdown({change: cp2textfield}, resultlocations.map(o => ({v: o.number, txt: o.number + ' ' + o.text}))).ebbind(data, 'resultlocation');
      $('#ddresult').ebdropdown({change: cp2textfield}, results.map(o => ({v: o.number, txt: o.number + ' ' + o.text}))).ebbind(data, 'result');

      $('#tfag').change(cp2dd).ebbind(data, 'fag')
      $('#tresultcategory').change(cp2dd).ebbind(data, 'resultcategory')
      $('#tresultlocation').change(cp2dd).ebbind(data, 'resultlocation')
      $('#tresult').change(cp2dd).ebbind(data, 'result')

      $('#begutachtungsdatum').datepicker(datepickerOptions).ebbind(data);
      $('#gutachter').ebbind(data);
      $('#bearbeitungsdauerHours').ebbind(data);
      $('#bearbeitungsdauerMins').ebbind(data);

      $('.ui-icon-search').click(function () {
        dlgSelectExperts(function (v) {
          data.expertsid = v.userid;
          $('#gutachter').val(v.name);
          return true;
        });
      });
      $('.ui-icon-trash').click(function () {
        $('#gutachter').val(null);
      });

      // styling
      $('.ui-selectmenu-button').width('500px');
      $("#bearbeitungsdauerHours,#bearbeitungsdauerMins").css('width', '65px')
    });
  </script>
</head>

<body>
  <h1>Mima-SFB erstellen</h1>
  <table id="layouttable1">
    <tbody>
      <tr><td>Produkt           </td><td>                                                                 </td><td><div id='ddproduct'></div></td></tr>
      <tr><td>Frage Auftraggeber</td><td><input id='tfag' class='positive-integer' type='text'>           </td><td><div id='ddfag'></div></td></tr>
      <tr><td>Erledigungsart    </td><td><input id='tresultcategory' class='positive-integer' type='text'></td><td><div id='ddresultcategory'></div></td></tr>
      <tr><td>Erledigungsort    </td><td><input id='tresultlocation' class='positive-integer' type='text'></td><td><div id='ddresultlocation'></div></td></tr>
      <tr><td>Ergebnis          </td><td><input id='tresult' class='positive-integer' type='text'>        </td><td><div id='ddresult'></div></td></tr>
    </tbody>
  </table>
  <table id="layouttable2">
    <tr><td>Begutachtungsdatum</td><td><input type='text' id='begutachtungsdatum'></td></tr>
    <tr>
      <td>Verantwortlicher Gutachter</td>
      <td><input type='text' id='gutachter' disabled>
        <span id='gaSearch' style="display:inline-block;" class="ui-icon ui-icon-search" title='Gutachter anzeigen/auswÃ¤hlen'></span>
        <span id='gaDelete' style="display:inline-block;" class="ui-icon ui-icon-trash"  title='Gutachter entfernen'></span>
      </td>
    </tr>
    <tr>
      <td>Bearbeitungsdauer(Std/Min)</td><td><input type='text' class='positive-integer' id='bearbeitungsdauerHours'> / <input type='text' class='positive-integer' id='bearbeitungsdauerMins'></td>
    </tr>
  </table>
</body>
</html>
