<!DOCTYPE html>
<html>
   <head>
      <title>Beispiel 4 Nur ein TEST</title>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />

      <link rel="stylesheet" href="/lib/jQueryUI-1.11.4/jquery-ui.css">
      <link rel="stylesheet" href="/css/ebtable.css">
      <style>
         * {
            font-family:Arial;
            color: black;
            font-size: 10px;
         }
      </style>

      <script src="/lib/underscore-1.8.3/underscore-1.8.3.js"></script>
      <script src="/lib/jquery-1.11.3/jquery-1.11.3.js"></script>
      <script src="/lib/jQueryUI-1.11.4/jquery-ui.js"></script>
      <script src="/js/mx.js"></script>
      <script src="/js/ebtable.js"></script>
      <script src="/data/ebTableTestDataKhbasket.js"></script>

      <script>
         'use strict';
         var grid;
         var renderer = {
            renderAuftrag: function (data, row) {
               var chargeId = row[2];
               if (chargeId < 0) 
                  return row[10] + data;;
               var isOpen = grid ? grid.groupIsOpen(chargeId) : false;
               var imgsrc = !isOpen ? '/images/group_opened.png' : '/images/group_closed.png';
               var t = '\
                  <img src="<%=imgsrc%>" onclick="grid.toggleGroupIsOpen(\'<%=chargeId%>\')" />\n\
                  <b>&nbsp;<%=chargeName%>&nbsp;</b>\
                  (<%=cnt%> Aufträge)';
               var link =  _.template(t)({imgsrc:imgsrc, chargeId: chargeId,chargeName:row[10], cnt:row[1]});
               return row[0] === 'C' ? link : data;
            },
            renderFlags: function (data, row, type) {
               if ( type === 'filter') {// || type === 'display') 
                  return grid.sortformats.flags(data);
               }
               var imgmap = [
                  {key: '!', id: 1, img: 'important.gif', alt: 'Eilauftrag'},
                  {key: '*', id: 2, img: 'blackstar.gif', alt: 'Spezialfall'},
                  {key: 'P', id: 4, img: 'problem.gif', alt: 'Problemfall'},
                  {key: 'F', id: 8, img: 'caseConsolidation.gif', alt: 'Fallzusammenführung'},
                  {key: 'G', id: 16, img: 'isPrg.gif', alt: 'Prg'},
                  {key: 'K', id: 32, img: 'korrekturauftrag.gif', alt: 'Korrekturauftrag'},
                  {key: 'S', id: 64, img: 'sperre.gif', alt: 'Sperre'},
                  {key: 'C', id: 128, img: 'storniert.gif', alt: 'Stornierung angefordert'}
               ];
               var s = '';
               for (var i = 0; i < imgmap.length; i++) {
                  var o = imgmap[i];
                  if (data & o.id)
                     s += "<img src='/images/" + o.img + "' alt='" + o.alt + "' title='" + o.alt + "' />";
               }
               return s;
            },
            renderFrist: function (data, row, type) {
               //var chargeId = _.isNumber(row[2]) ? row[2].toString() : row[2];
               //var g = grid.getGroup(chargeId);
               //var frist = g ? g.fristmin : data;
//               if ( type === 'filter') {// || type === 'display') {
//                  return sprintf("%+05d#%+08s", frist, data);
//               }
               return data;// sprintf("%+05d#%+08d", frist, data);// data;
            }
         };

         var opts = {
            columns: [
               {name: "Grouping", technical: true, invisible: true, order: 'asc-fix'},
               {name: "GroupCount", technical: true, invisible: true},
               {name: "GroupId", technical: true, invisible: true},
               {name: "WorkorderId", technical: true, invisible: true},
               {name: "StatusId", technical: true, invisible: true},
               {name: "Performer", technical: true, invisible: true},
               {name: "Flags", render: renderer.renderFlags, sortformat: 'flags', tooltip:'Mögliche Werte:!*PFGKSC'},
               {name: "Frist", render: renderer.renderFrist},
               {name: "Status"},
               {name: "XXXX"},
               {name: "Auftrag", render: renderer.renderAuftrag},
               {name: "Krankenhaus"},
               {name: "Abteilung"},
               {name: "AAAA"},
               {name: "BBBB"},
               {name: "Krankenkasse"},
               {name: "Einlieferung", sortformat: 'date-de'},
               {name: "Entlassung", sortformat: 'date-de'},
               {name: "DDD"},
               {name: "BEEEBBB"},
               {name: "FFF"},
               {name: "GGG"},
               {name: "DTA-Nummern"},
               {name: "WWW"},
               {name: "KH-Frist"}
            ],
            selection: true,
            sortmaster: [{col: 2}, {col: 0}], //[{col:1,order:'asc',sortType:'date-de'},{col:2,order:'desc'}]
            groupingCols: {groupid: 2, groupsort: 0, grouphead: 'C'}
         };

         $().ready(function () {
            grid = $('#grid').ebtable(opts, basketTestdataKH);
         });
      </script>
   </head>
   <body>
      <div id="grid"></div>
   </body>
</html>
