<!DOCTYPE html>
<html>
  <head>
    <title>TODO supply a title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * {
        font-family:Arial;
        color: black;
        font-size: 10px;
      }
      #head,#data { 
        background-color:#eee;
      }

      #head th{ 
        background-color:#ddd; 
        padding: 1px 2px 1px 2px;
      }

      #head th input {
        width: 80%;
        padding: 0px;
        box-sizing: border-box;
      }

      #head th div.sort_wrapper {
        position: relative;
      }

      #head th div.sort_wrapper span {
        position: absolute;
        margin-top: 10px;
        right: -5px;
      }

      #data td{ 
        background-color:white;
        padding: 1px 2px 1px 2px;
      }         
    </style>
    <link rel="stylesheet" type="text/css" href="jquery.tablescroll.css"/>

    <script src="/lib/underscore-1.8.3/underscore-1.8.3.js"></script>
    <script src="/lib/jQuery-1.11.3/jquery-1.11.3.js"></script>
    <script src="/lib/jquery.tablescroll.js"></script>
    <script>
      var scrollbarWidth = 0;
      $(document).ready(function () {
        scrollbarWidth = function () {
          var div = $('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div></div>');
          $('body').append(div);
          var w1 = $('div', div).innerWidth();
          div.css('overflow-y', 'auto');
          var w2 = $('div', div).innerWidth();
          $(div).remove();
          return w1 - w2;
        }();
      });

      function wdths() {
        var wh = $("#head").width();
        var wd = $("#data").width();
        var wb = $('body').width();
        var ww = $(window).width();
        return {
          wh: wh,
          wd: wd,
          wb: wb,
          ww: ww,
          wm: Math.floor(Math.max(wh, wd, wb - scrollbarWidth))
        };
      }

      function adjustWidth(n) {
        if (n > 5)
          return;
        var ws = wdths();
        console.log('Width tables', 'head:', ws.wh, 'data:', ws.wd, 'body', ws.wb, 'win', ws.ww, 'max:', ws.wm, 'sbwith:', scrollbarWidth);
        if (Math.abs(ws.wh - ws.wd) > 1) {
          $('#head,#data').width(ws.wm);
          $('#divdata').width(ws.wm + scrollbarWidth);
          adjustWidth(n + 1);
        }
      }

      function adjustColumns(n) {
        if (n > 5)
          return;
        adjustWidth(0);
        $('#head th').each(function (i) {
          var w1 = $('#head th:nth-child(' + (i + 1) + ')').width();
          var w2 = $('#data td:nth-child(' + (i + 1) + ')').width();
          //if (w1 !== w2) {
          var w = Math.max(w1, w2);
          console.log('Spalte', i + 1, 'head:', w1, 'data:', w2, 'max:', w);
          $('#head th:nth-child(' + (i + 1) + ')').width(w);
          $('#data td:nth-child(' + (i + 1) + ')').width(w);
          //}
        });
        $('#head th').each(function (i) {
          var w1 = $('#head th:nth-child(' + (i + 1) + ')').width();
          var w2 = $('#data td:nth-child(' + (i + 1) + ')').width();
          if (w1 !== w2) {
            console.log('Aua:', i, n);
            var ws = wdths();
            $('#head,#data').width(Math.floor(ws.wm) + 10);
            $('#divdata').width(ws.wm + 10 + scrollbarWidth);
            return adjustColumns(n + 1);
          }
        });
      }

      function adjust() {
        $('#data').prepend($('#head tr'))
        var wtable = $('#data').width();
        var wcells = $('#data tr:first td').map(function (i, o) {
          return $(o).width();
        });
        console.log('wtable:', wtable, 'wcells', wcells);
        $('#head').append($('#data tr:first'));
        $('#head,#data').width(wtable);
        $('#head td').each(function (i, o) {
          $(o).width(wcells[i]);
        });
        $('#data tr:first td').each(function (i, o) {
          $(o).width(wcells[i]);
        });
      }
    </script>
    <script>
      $(document).ready(function () {
        adjust();
////            $('#head,#data').width(Math.floor(wdths().ww) - 30);
//            $('#divdata').width($('#data').width() + 14);
//            adjustColumns(0);
//            $(window).on("resize", function () {
//               console.log('resizing');
//               $('#head,#data').width(Math.floor(wdths().ww) - 30);
//               $('#divdata').width($('#data').width() + 14);
//               adjustColumns(0);
//            });
      });
    </script>

  </head>
  <body>
    <div id='divall' style='overflow-x:auto'>
      <div id='divhead'>
        <table id='head' border=1>
          <tr><td>Flags</td> <td>BBBB BBB </td> <td>XXXX XXXXXXXXX </td>   <td>MIST </td>  <td>Krankenhaus   </td> <td>Krankenkasse  </td></tr>
        </table>
      </div>
      <div id='divdata' style='overflow-y:auto;overflow-x:hidden; max-height:200px;'>
        <table id='data' border=1>
          <tr><td >001</td>   <td>BBBB BBB </td> <td>XXXX XXXXXXXXX </td> <td>aW  </td>  <td>Eiterfreude   </td> <td>AOK  </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
          <tr><td >010</td>   <td>BBBB     </td> <td>YY </td>             <td>iii </td>  <td>KK Eiterfreude</td> <td>Techniker Karankenkasse </td></tr>
        </table>
      </div>
    </div>
  </body>
</html>
