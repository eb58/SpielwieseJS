<!DOCTYPE html>
<html>
  <head>
    <title>TODO supply a title</title>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='/lib/jQueryUI-1.11.4/jquery-ui.css'>
    <style>
      * {font-family:Arial;color: black;font-size: 10px;}
      body{ margin: 20px 20px 20px 20px; }

      .textfield{ margin: 15px 1px 15px 1px; width:500px;}
      .ui-accordion-content{ height: 150px; }
      textarea{ width:500px;}

      #orderresponse { width:500px; }
      #himilist{ margin: 5px 1px 5px 1px; width:500px;}
      #orderattr{ margin: 5px 1px 5px 1px; width:500px;}

      table, td { border: 1px solid lightgrey; border-collapse: collapse;}
      table td:first-child { width: 500px;}
    </style>
    <link rel='stylesheet' href='/css/ebtable.css'>

    <script src='/lib/underscore-1.8.3/underscore-1.8.3.js'></script>
    <script src='/lib/jquery-1.11.3/jquery-1.11.3.js'></script>
    <script src='/lib/jQueryUI-1.11.4/jquery-ui.js'></script>
    <script src="/data/himidata.js"></script>
    <script src="/js/himi.js"></script>

    <script>
      var renderer = {
        edit: function (data) {
          return "<span id='" + data + "' class='ui-icon ui-icon-pencil'></span>";
        },
        del: function (data) {
          return "<span id='" + data + "' class='ui-icon ui-icon-trash'></span>";
        }
      };

      function selectBox(id, opts) {
        return  _.template("<select id='<%=id%>'><%=opts%></select>")({opts: himiutils.opts(opts), id: id});
      }

      $(document).ready(function () {
        var himidata = jsonresult.himi;
        var himis = himidata.himis;
        var opts = {columns: [
            {},
            {render: renderer.edit},
            {render: renderer.del}
          ]};
        $('#grid').himitable(opts, himis);

        $('#answ').append(selectBox('orderresponse', answs));
        $('#orderresponse').selectmenu();

        $('#medical-base').val(himidata['medical-base']);
        $('#anamnesis').val(himidata['anamnesis']);
        $('#indication').val(himidata['indication']);
        $('#evaluation').val(himidata['evaluation']);
        $('#suggestion').val(himidata['suggestion']);

        // Actions
        $('.ui-icon-pencil').on('click', function (ev) {
          console.log(ev.target.id);
          var himiname = ev.target.id;
          $('#dlgHimi input').val(himiname);
          $('#dlgHimi').dialog('option', 'title', 'Hilfmittel ' + himiname).dialog('open');
          $('#accor').himiaccordion(himis[0].qas, quests, answs);
          $('#himiaccordion').accordion();
          $('#q1,#a1').selectmenu();
        });
        $('.ui-icon-trash').on('click', function (ev) {
          $('#' + ev.target.id).parent().parent().remove();
        });
        $('#add').on('click', function () {
          $('#dlgHimi input').val('');
          $('#dlgHimi').dialog('option', 'title', 'Neues Hilfmittel').dialog('open');
        });

        // HIMI-Dialog
        $('#dlgHimi').dialog({
          title: 'Hilfsmittel',
          autoOpen: false,
          height: 400,
          width: 500
        });
      });
    </script>
  </head>
  <body>
    <div id='himilist'>
      <h1>Hilfsmittel:</h1>
      <div id='grid'></div>
      <span id='add' class='ui-icon ui-icon-circle-plus'></span>
      <br>
    </div>
    <div id='orderattr'>
      <h1>Auftrags-Antwort:</h1>
      <div id='answ'></div>
      <div class='textfield'>
        <h1>Medizinische Unterlagen:</h1>
        <textarea id='medical-base' rows='3' cols='80'></textarea>
      </div>
      <div class='textfield'>
        <h1>Anamnese:</h1>
        <textarea id='anamnesis' rows='3' cols='80'></textarea>
      </div>
      <div class='textfield'>
        <h1>Befund:</h1>
        <textarea id='indication' rows='3' cols='80'></textarea>
      </div>
      <div class='textfield'>
        <h1>Antwort mit Begr√ºndung:</h1>
        <textarea id='evaluation' rows='3' cols='80'></textarea>
      </div>
      <div class='textfield'>
        <h1>Empfehlung:</h1>
        <textarea id='suggestion' rows='3' cols='80'></textarea>
      </div>
    </div>


    <div id='dlgHimi'>
      <h1>Hilfsmittel:</h1>
      <input id='himi' style='width:100%' type='text'/>
      <div id='accor'></div>
    </div>
  </body>
</html>
